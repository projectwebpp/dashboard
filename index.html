<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE Messaging API Dashboard - Advanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans Thai', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Section */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 30px 0;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .header .features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .feature-tag {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        /* Configuration Panel */
        .config-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .config-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        .config-header h2 {
            color: #333;
            font-size: 1.5em;
            margin-left: 10px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.95em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-hint {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #00c851, #00b341);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffbb33, #ff8800);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Status Bar */
        .status-bar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .status-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .status-item .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .status-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .status-item .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        /* Main Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Metrics Section */
        .metrics-section {
            display: grid;
            gap: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .metric-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .metric-icon {
            font-size: 1.5em;
            opacity: 0.7;
        }

        .metric-value {
            font-size: 2.8em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .metric-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
        }

        .metric-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-ready { background: #00c851; }
        .status-unready { background: #ff4444; }
        .status-loading { background: #ffbb33; }
        .status-error { background: #ff6b6b; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .metric-progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .metric-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #00c851, #00b341);
            border-radius: 4px;
            transition: width 1s ease;
        }

        /* Sidebar */
        .sidebar {
            display: grid;
            gap: 20px;
        }

        /* Alert Panel */
        .alert-panel {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .alert-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .alert-header h3 {
            margin-left: 10px;
            color: #333;
        }

        .alert-config {
            margin-bottom: 20px;
        }

        .alert-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #ffbb33;
        }

        .alert-item.active {
            border-left-color: #ff4444;
            background: #fff5f5;
        }

        /* API Endpoints Panel */
        .api-panel {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .api-endpoint {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
        }

        .api-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 10px;
        }

        .api-method.get { background: #28a745; color: white; }
        .api-method.post { background: #007bff; color: white; }

        .api-url {
            color: #333;
            font-size: 0.9em;
            word-break: break-all;
        }

        .api-description {
            font-size: 0.85em;
            color: #666;
            margin-top: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* Flex Message Section */
        .flex-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .flex-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .flex-visual {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px dashed #dee2e6;
        }

        .flex-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .flex-bubble {
            max-width: 300px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: hidden;
            margin: 0 auto;
        }

        .flex-header {
            background: #fff5f5;
            padding: 20px;
            text-align: center;
        }

        .flex-body {
            padding: 20px;
        }

        .flex-footer {
            padding: 15px 20px;
        }

        .flex-button {
            width: 100%;
            padding: 12px;
            background: #00c851;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Log Section */
        .log-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
        }

        .log-info { background: #d1ecf1; color: #0c5460; }
        .log-success { background: #d4edda; color: #155724; }
        .log-warning { background: #fff3cd; color: #856404; }
        .log-error { background: #f8d7da; color: #721c24; }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: #00c851; }
        .notification.error { background: #ff4444; }
        .notification.warning { background: #ffbb33; }
        .notification.info { background: #33b5e5; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .flex-preview {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .header .features {
                gap: 15px;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .status-items {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .metric-value {
                font-size: 2.2em;
            }
            
            .status-items {
                grid-template-columns: 1fr;
            }
        }

        /* Dark mode toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50px;
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>

    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>üöÄ LINE Messaging API Dashboard</h1>
            <p class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE Official Account ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô</p>
            <div class="features">
                <span class="feature-tag">üìä Real-time Monitoring</span>
                <span class="feature-tag">üîî Smart Alerts</span>
                <span class="feature-tag">üì± Flex Messages</span>
                <span class="feature-tag">üìà Analytics</span>
                <span class="feature-tag">‚ö° API Testing</span>
            </div>
        </div>

        <!-- Configuration Panel -->
        <div class="config-panel">
            <div class="config-header">
                <span style="font-size: 1.5em;">‚öôÔ∏è</span>
                <h2>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
            </div>
            
            <div class="config-grid">
                <div class="form-group">
                    <label>üîë Channel Access Token</label>
                    <input type="password" id="accessToken" placeholder="‡πÉ‡∏™‡πà Channel Access Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    <div class="input-hint">Token ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                
                <div class="form-group">
                    <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                    <input type="text" id="dateInput" placeholder="YYYYMMDD ‡πÄ‡∏ä‡πà‡∏ô 20250710">
                    <div class="input-hint">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: YYYYMMDD (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 31 ‡∏°‡∏µ.‡∏Ñ. 2018)</div>
                </div>
                
                <div class="form-group">
                    <label>‚è±Ô∏è ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</label>
                    <select id="updateInterval">
                        <option value="manual">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</option>
                        <option value="30000">‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                        <option value="60000">‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                        <option value="300000">‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                        <option value="900000">‡∏ó‡∏∏‡∏Å 15 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                    </select>
                    <div class="input-hint">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</div>
                </div>
                
                <div class="form-group">
                    <label>üéØ ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
                    <select id="workingMode">
                        <option value="development">Development (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</option>
                        <option value="production">Production (API ‡∏à‡∏£‡∏¥‡∏á)</option>
                    </select>
                    <div class="input-hint">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="fetchAllData()">
                    <span id="fetchIcon">üîÑ</span> ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button class="btn btn-success" onclick="testConnection()">
                    üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
                <button class="btn btn-primary" onclick="validateCredentials()">
                    üîë ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Token
                </button>
                <button class="btn btn-warning" onclick="exportData()">
                    üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button class="btn" onclick="clearData()" style="background: #6c757d; color: white;">
                    üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-items">
                <div class="status-item">
                    <div class="icon">üåê</div>
                    <div class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
                    <div class="value" id="connectionStatus">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
                </div>
                <div class="status-item">
                    <div class="icon">‚è∞</div>
                    <div class="label">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                    <div class="value" id="lastUpdate">-</div>
                </div>
                <div class="status-item">
                    <div class="icon">üìä</div>
                    <div class="label">API Calls ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="value" id="apiCallsCount">0</div>
                </div>
                <div class="status-item">
                    <div class="icon">‚ö°</div>
                    <div class="label">Rate Limit</div>
                    <div class="value" id="rateLimit">-</div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard-grid">
            <!-- Metrics Section -->
            <div class="metrics-section">
                <div class="metrics-grid" id="metricsGrid">
                    <!-- Quota Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ</div>
                            <div class="metric-icon">üí≥</div>
                        </div>
                        <div class="metric-value" id="quotaValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="quotaStatus"></span>
                                <span id="quotaStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                        <div class="metric-progress">
                            <div class="metric-progress-bar" style="width: 0%" id="quotaProgress"></div>
                        </div>
                    </div>

                    <!-- Usage Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üìà ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</div>
                            <div class="metric-icon">‚ö°</div>
                        </div>
                        <div class="metric-value" id="usageValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">Real-time Usage</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="usageStatus"></span>
                                <span id="usagePercentage">0%</span>
                            </div>
                        </div>
                        <div class="metric-progress">
                            <div class="metric-progress-bar" style="width: 0%" id="usageProgress"></div>
                        </div>
                    </div>

                    <!-- Reply Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üí¨ Reply Messages</div>
                            <div class="metric-icon">‚Ü©Ô∏è</div>
                        </div>
                        <div class="metric-value" id="replyValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="replyStatus"></span>
                                <span id="replyStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>

                    <!-- Push Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üì§ Push Messages</div>
                            <div class="metric-icon">üì¨</div>
                        </div>
                        <div class="metric-value" id="pushValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∏‡∏ä</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="pushStatus"></span>
                                <span id="pushStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>

                    <!-- Multicast Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üì° Multicast Messages</div>
                            <div class="metric-icon">üìª</div>
                        </div>
                        <div class="metric-value" id="multicastValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="multicastStatus"></span>
                                <span id="multicastStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>

                    <!-- Broadcast Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üì¢ Broadcast Messages</div>
                            <div class="metric-icon">üì∫</div>
                        </div>
                        <div class="metric-value" id="broadcastValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="broadcastStatus"></span>
                                <span id="broadcastStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Alert Panel -->
                <div class="alert-panel">
                    <div class="alert-header">
                        <span style="font-size: 1.5em;">üîî</span>
                        <h3>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    </div>
                    
                    <div class="alert-config">
                        <div class="form-group">
                            <label>üéØ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (%)</label>
                            <input type="number" id="alertThreshold" value="80" min="1" max="100">
                            <div class="input-hint">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ô‡∏µ‡πâ</div>
                        </div>
                        
                        <div class="form-group">
                            <label>üåê Webhook URL</label>
                            <input type="url" id="webhookUrl" placeholder="https://your-webhook.com">
                            <div class="input-hint">URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                        </div>
                        
                        <div class="form-group">
                            <label>üë§ User ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                            <input type="text" id="alertUserId" placeholder="U1234567890abcdef1234567890abcdef">
                            <div class="input-hint">User ID ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Push Message)</div>
                        </div>
                        
                        <div class="form-group">
                            <label>üë• Group ID (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                            <input type="text" id="alertGroupId" placeholder="C1234567890abcdef1234567890abcdef">
                            <div class="input-hint">Group ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-warning" onclick="checkAlerts()" style="width: 100%; margin-bottom: 15px;">
                        üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </button>
                    
                    <button class="btn btn-primary" onclick="sendTestAlert()" style="width: 100%; margin-bottom: 15px;">
                        üì± ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    </button>
                    
                    <div id="alertsList">
                        <div class="alert-item">
                            <div>
                                <strong>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á</strong><br>
                                <small>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 80%</small>
                            </div>
                            <span id="alertStatus1">üò¥</span>
                        </div>
                        
                        <div class="alert-item">
                            <div>
                                <strong>Rate Limit</strong><br>
                                <small>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î</small>
                            </div>
                            <span id="alertStatus2">üò¥</span>
                        </div>
                        
                        <div class="alert-item">
                            <div>
                                <strong>User ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</strong><br>
                                <small>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö User ID ‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà</small>
                            </div>
                            <span id="alertStatus4">üò¥</span>
                        </div>
                    </div>
                </div>

                <!-- API Endpoints Panel -->
                <div class="api-panel">
                    <div class="alert-header">
                        <span style="font-size: 1.5em;">üîó</span>
                        <h3>API Endpoints</h3>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/quota</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/quota/consumption</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏ö‡∏ö Real-time</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method post">POST</span>
                        <div class="api-url">/v2/bot/message/push</div>
                        <div class="api-description">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á User ID</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/delivery/reply</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Reply Messages</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/delivery/multicast</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Multicast Messages</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/delivery/broadcast</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Broadcast Messages</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/insight/message/delivery</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flex Message Section -->
        <div class="flex-section">
            <div class="alert-header">
                <span style="font-size: 1.5em;">üì±</span>
                <h3>Flex Message Generator</h3>
            </div>
            
            <div class="config-grid" style="margin-bottom: 20px;">
                <div class="form-group">
                    <label>üé® ‡∏ò‡∏µ‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                    <select id="flexTheme">
                        <option value="warning">‚ö†Ô∏è Warning (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)</option>
                        <option value="danger">üö® Danger (‡∏™‡∏µ‡πÅ‡∏î‡∏á)</option>
                        <option value="info">‚ÑπÔ∏è Info (‡∏™‡∏µ‡∏ü‡πâ‡∏≤)</option>
                        <option value="success">‚úÖ Success (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                    <input type="text" id="customMessage" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="generateFlexMessage()" style="margin-bottom: 20px;">
                üé® ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message
            </button>
            
            <div class="flex-preview" id="flexPreview" style="display: none;">
                <div class="flex-visual">
                    <h4>üëÄ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Flex Message</h4>
                    <div class="flex-bubble" id="flexBubble">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>
                
                <div>
                    <h4>üíª JSON Code</h4>
                    <div class="flex-code" id="flexCode">
                        <!-- JSON code will be inserted here -->
                    </div>
                    <button class="btn btn-success" onclick="copyFlexMessage()" style="margin-top: 15px; width: 100%;">
                        üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON
                    </button>
                </div>
            </div>
        </div>

        <!-- Detailed Analytics Section -->
        <div class="flex-section">
            <div class="alert-header">
                <span style="font-size: 1.5em;">üìà</span>
                <h3>‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å</h3>
            </div>
            
            <div class="config-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">üìä ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</div>
                        <div class="metric-icon">‚è∞</div>
                    </div>
                    <canvas id="hourlyChart" width="400" height="200"></canvas>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 7 ‡∏ß‡∏±‡∏ô</div>
                        <div class="metric-icon">üìÖ</div>
                    </div>
                    <canvas id="weeklyChart" width="400" height="200"></canvas>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">ü•ß ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
                        <div class="metric-icon">üìä</div>
                    </div>
                    <canvas id="pieChart" width="400" height="200"></canvas>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">‚ö° Performance Metrics</div>
                        <div class="metric-icon">üéØ</div>
                    </div>
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <strong>API Response Time:</strong> <span id="avgResponseTime">-</span> ms
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Success Rate:</strong> <span id="successRate">-</span>%
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Error Rate:</strong> <span id="errorRate">-</span>%
                        </div>
                        <div>
                            <strong>Uptime:</strong> <span id="uptime">-</span>%
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log Section -->
        <div class="log-section">
            <div class="alert-header">
                <span style="font-size: 1.5em;">üìù</span>
                <h3>‡∏£‡∏∞‡∏ö‡∏ö Log ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                <button class="btn" onclick="clearLogs()" style="margin-left: auto; background: #6c757d; color: white;">
                    üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Log
                </button>
            </div>
            
            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">
                    [<span id="currentTime"></span>] üìã ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentData = {};
        let updateInterval = null;
        let logEntries = [];
        let apiCallsToday = 0;
        let isDarkMode = false;

        // Initialize the application
        window.onload = function() {
            initializeApp();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        };

        function initializeApp() {
            // Set default date
            const today = new Date();
            const dateString = today.getFullYear() + 
                              String(today.getMonth() + 1).padStart(2, '0') + 
                              String(today.getDate()).padStart(2, '0');
            document.getElementById('dateInput').value = dateString;
            
            // Set demo token
            document.getElementById('accessToken').value = 'your-channel-access-token-here';
            
            addLog('üìã ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', 'info');
            addLog('‚öôÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...', 'info');
            
            // Auto-load demo data after 2 seconds
            setTimeout(() => {
                addLog('üé≠ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'info');
                fetchAllData();
            }, 2000);
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('th-TH');
            const currentTimeElement = document.getElementById('currentTime');
            if (currentTimeElement) {
                currentTimeElement.textContent = timeString;
            }
        }

        // Main data fetching function
        async function fetchAllData() {
            const token = document.getElementById('accessToken')?.value;
            const date = document.getElementById('dateInput')?.value;
            const mode = document.getElementById('workingMode')?.value;

            if (!token) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }

            if (!date || !/^\d{8}$/.test(date)) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYYMMDD', 'error');
                return;
            }

            // Update UI states
            const fetchIcon = document.getElementById('fetchIcon');
            const fetchButton = document.querySelector('[onclick="fetchAllData()"]');
            
            if (fetchIcon) {
                fetchIcon.innerHTML = '<div class="loading"></div>';
            }
            if (fetchButton) {
                fetchButton.disabled = true;
            }
            
            updateConnectionStatus('connecting');
            
            addLog('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...', 'info');

            try {
                // Simulate API calls with realistic delays
                await fetchWithProgress('quota', fetchQuota, token);
                await fetchWithProgress('usage', fetchUsage, token);
                await fetchWithProgress('delivery', fetchDeliveryStats, token, date);
                await fetchWithProgress('insight', fetchInsightData, token, date);
                
                updateConnectionStatus('connected');
                updateLastUpdate();
                apiCallsToday += 7;
                
                const apiCallsElement = document.getElementById('apiCallsCount');
                if (apiCallsElement) {
                    apiCallsElement.textContent = apiCallsToday;
                }
                
                showNotification('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                addLog('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
                
                // Auto-check alerts
                setTimeout(checkAlerts, 1000);
                
            } catch (error) {
                updateConnectionStatus('error');
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                addLog('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            } finally {
                if (fetchIcon) {
                    fetchIcon.textContent = 'üîÑ';
                }
                if (fetchButton) {
                    fetchButton.disabled = false;
                }
            }
        }

        async function fetchWithProgress(type, fetchFunction, ...args) {
            addLog(`üì° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${type}...`, 'info');
            await fetchFunction(...args);
            addLog(`‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${type} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
        }

        // Individual API fetch functions (with simulated data)
        async function fetchQuota(token) {
            await simulateApiCall(800);
            
            const mockData = {
                type: "limited",
                value: 15000
            };
            
            currentData.quota = mockData;
            updateMetricCard('quota', mockData.value, 'üìä ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', 'ready', 100);
        }

        async function fetchUsage(token) {
            await simulateApiCall(600);
            
            const mockData = {
                totalUsage: Math.floor(Math.random() * 12000) + 4000
            };
            
            currentData.usage = mockData;
            const percentage = currentData.quota ? (mockData.totalUsage / currentData.quota.value) * 100 : 0;
            
            updateMetricCard('usage', mockData.totalUsage, `üí° ${percentage.toFixed(1)}% ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô`, 'ready', percentage);
            
            const usagePercentageElement = document.getElementById('usagePercentage');
            if (usagePercentageElement) {
                usagePercentageElement.textContent = percentage.toFixed(1) + '%';
            }
        }

        async function fetchDeliveryStats(token, date) {
            await simulateApiCall(1000);
            
            const mockData = {
                reply: { status: "ready", success: Math.floor(Math.random() * 2000) + 1500 },
                push: { status: "ready", success: Math.floor(Math.random() * 1500) + 800 },
                multicast: { status: "ready", success: Math.floor(Math.random() * 800) + 300 },
                broadcast: { status: "ready", success: Math.floor(Math.random() * 500) + 200 }
            };
            
            currentData.delivery = mockData;
            
            Object.keys(mockData).forEach(type => {
                updateMetricCard(type, mockData[type].success, getTypeLabel(type), mockData[type].status);
            });
        }

        async function fetchInsightData(token, date) {
            await simulateApiCall(900);
            
            const mockData = {
                status: "ready",
                broadcast: Math.floor(Math.random() * 3000) + 2000,
                targeting: Math.floor(Math.random() * 2000) + 1000,
                apiBroadcast: currentData.delivery?.broadcast?.success || 256,
                apiPush: currentData.delivery?.push?.success || 1024,
                apiMulticast: currentData.delivery?.multicast?.success || 512,
                apiReply: currentData.delivery?.reply?.success || 2048
            };
            
            currentData.insight = mockData;
            addLog('üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Insight: OA Manager + API ‡∏£‡∏ß‡∏°', 'info');
        }

        function updateMetricCard(type, value, label, status, progress = 0) {
            const valueElement = document.getElementById(`${type}Value`);
            const statusElement = document.getElementById(`${type}Status`);
            const statusTextElement = document.getElementById(`${type}StatusText`);
            
            if (valueElement) {
                valueElement.textContent = value.toLocaleString();
            }
            
            if (statusElement) {
                statusElement.className = `status-indicator status-${status}`;
            }
            
            if (statusTextElement) {
                statusTextElement.textContent = getStatusText(status);
            }
            
            if (progress > 0) {
                const progressBar = document.getElementById(`${type}Progress`);
                if (progressBar) {
                    progressBar.style.width = Math.min(progress, 100) + '%';
                    if (progress > 80) {
                        progressBar.style.background = 'linear-gradient(45deg, #ff4444, #cc0000)';
                    } else if (progress > 60) {
                        progressBar.style.background = 'linear-gradient(45deg, #ffbb33, #ff8800)';
                    }
                }
            }
        }

        function getTypeLabel(type) {
            const labels = {
                reply: 'üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö',
                push: 'üì§ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∏‡∏ä',
                multicast: 'üì° ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô',
                broadcast: 'üì¢ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®'
            };
            return labels[type] || type;
        }

        function getStatusText(status) {
            const texts = {
                ready: '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                unready: '‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°',
                out_of_service: '‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ',
                loading: 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
                error: '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'
            };
            return texts[status] || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
        }

        // Alert system with LINE Messaging API
        function checkAlerts() {
            if (!currentData.quota || !currentData.usage) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'error');
                return;
            }
            
            const thresholdElement = document.getElementById('alertThreshold');
            const threshold = thresholdElement ? parseInt(thresholdElement.value) : 80;
            const usagePercent = (currentData.usage.totalUsage / currentData.quota.value) * 100;
            
            addLog(`üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${usagePercent.toFixed(1)}% (‡πÄ‡∏Å‡∏ì‡∏ë‡πå: ${threshold}%)`, 'info');
            
            // Update alert statuses (with null checks)
            const alertStatus1 = document.getElementById('alertStatus1');
            const alertStatus2 = document.getElementById('alertStatus2');
            const alertStatus3 = document.getElementById('alertStatus3');
            
            if (alertStatus1) alertStatus1.textContent = usagePercent >= threshold ? 'üö®' : 'üò¥';
            if (alertStatus2) alertStatus2.textContent = usagePercent >= 90 ? '‚ö†Ô∏è' : 'üò¥';
            if (alertStatus3) alertStatus3.textContent = '‚úÖ';
            
            if (usagePercent >= threshold) {
                generateFlexMessage();
                showNotification(`üö® ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${usagePercent.toFixed(1)}% ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå!`, 'warning');
                addLog(`üö® ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${usagePercent.toFixed(1)}%`, 'warning');
                
                // Send alert via LINE Messaging API
                sendLineAlert(usagePercent, threshold);
                
                // Send to webhook if configured
                const webhookUrlElement = document.getElementById('webhookUrl');
                const webhookUrl = webhookUrlElement ? webhookUrlElement.value : '';
                if (webhookUrl) {
                    sendWebhookAlert(webhookUrl, usagePercent, threshold);
                }
            } else {
                showNotification(`‚úÖ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏õ‡∏Å‡∏ï‡∏¥ (${usagePercent.toFixed(1)}%)`, 'success');
                addLog(`‚úÖ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥: ${usagePercent.toFixed(1)}%`, 'success');
            }
        }

        // Send alert via LINE Messaging API
        async function sendLineAlert(usagePercent, threshold) {
            const tokenElement = document.getElementById('accessToken');
            const userIdElement = document.getElementById('alertUserId');
            const groupIdElement = document.getElementById('alertGroupId');
            const modeElement = document.getElementById('workingMode');
            
            const token = tokenElement ? tokenElement.value : '';
            const userId = userIdElement ? userIdElement.value : '';
            const groupId = groupIdElement ? groupIdElement.value : '';
            const mode = modeElement ? modeElement.value : 'development';
            
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }
            
            if (!userId && !groupId) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà User ID ‡∏´‡∏£‡∏∑‡∏≠ Group ID', 'error');
                return;
            }
            
            const targetId = groupId || userId;
            const targetType = groupId ? '‡∏Å‡∏•‡∏∏‡πà‡∏°' : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
            
            try {
                addLog(`üì± ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE Messaging API ‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${targetType}...`, 'info');
                
                // Create alert message
                const alertMessage = createAlertMessage(usagePercent, threshold);
                
                // Create push data
                const pushData = {
                    to: targetId,
                    messages: [alertMessage]
                };
                
                if (mode === 'production') {
                    // Real API call
                    const response = await fetch('https://api.line.me/v2/bot/message/push', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(pushData)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                    }
                    
                    const result = await response.json();
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE API ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Production)`, 'success');
                    addLog(`üìÑ Response: ${JSON.stringify(result)}`, 'info');
                } else {
                    // Development mode - simulate call
                    await simulateApiCall(1500);
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Development Mode)`, 'success');
                }
                
                showNotification('üì± ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
                // Show message preview
                displaySentMessage(alertMessage);
                
                // Log the message details
                addLog(`üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á: ${JSON.stringify(pushData, null, 2)}`, 'info');
                
            } catch (error) {
                addLog(`‚ùå ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                showNotification('‚ùå ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message, 'error');
                
                // Show troubleshooting tips
                showTroubleshootingTips(error.message);
            }
        }

        // Test alert function with real API
        async function sendTestAlert() {
            const tokenElement = document.getElementById('accessToken');
            const userIdElement = document.getElementById('alertUserId');
            const groupIdElement = document.getElementById('alertGroupId');
            const modeElement = document.getElementById('workingMode');
            
            const token = tokenElement ? tokenElement.value : '';
            const userId = userIdElement ? userIdElement.value : '';
            const groupId = groupIdElement ? groupIdElement.value : '';
            const mode = modeElement ? modeElement.value : 'development';
            
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }
            
            if (!userId && !groupId) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà User ID ‡∏´‡∏£‡∏∑‡∏≠ Group ID', 'error');
                return;
            }
            
            const targetId = groupId || userId;
            const targetType = groupId ? '‡∏Å‡∏•‡∏∏‡πà‡∏°' : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
            
            try {
                addLog(`üß™ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${targetType}...`, 'info');
                
                const testMessage = createTestMessage();
                
                const pushData = {
                    to: targetId,
                    messages: [testMessage]
                };
                
                if (mode === 'production') {
                    // Real API call
                    const response = await fetch('https://api.line.me/v2/bot/message/push', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(pushData)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                    }
                    
                    const result = await response.json();
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Production)`, 'success');
                    addLog(`üìÑ Response: ${JSON.stringify(result)}`, 'info');
                } else {
                    // Development mode
                    await simulateApiCall(1000);
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Development Mode)`, 'success');
                }
                
                showNotification('üß™ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
                // Show test message in preview
                displaySentMessage(testMessage);
                
            } catch (error) {
                addLog(`‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                showNotification('‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message, 'error');
                
                // Show troubleshooting tips
                showTroubleshootingTips(error.message);
            }
        }

        // Create test message
        function createTestMessage() {
            return {
                type: "flex",
                altText: "üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô LINE API Dashboard",
                contents: {
                    type: "bubble",
                    size: "kilo",
                    header: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: "üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö",
                                weight: "bold",
                                color: "#0c5460",
                                size: "lg"
                            },
                            {
                                type: "text",
                                text: "LINE API Dashboard",
                                size: "sm",
                                color: "#666666"
                            }
                        ],
                        paddingAll: "20px",
                        backgroundColor: "#d1ecf1"
                    },
                    body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥! ‚úÖ",
                                weight: "bold",
                                size: "md",
                                wrap: true
                            },
                            {
                                type: "separator",
                                margin: "md"
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                margin: "md",
                                spacing: "sm",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üì± ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö",
                                        size: "sm",
                                        color: "#666666"
                                    },
                                    {
                                        type: "text",
                                        text: `‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}`,
                                        size: "sm",
                                        color: "#666666"
                                    },
                                    {
                                        type: "text",
                                        text: "üéØ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
                                        size: "sm",
                                        color: "#666666"
                                    }
                                ]
                            }
                        ]
                    },
                    footer: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "button",
                                style: "primary",
                                height: "sm",
                                action: {
                                    type: "uri",
                                    label: "üìä ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Dashboard",
                                    uri: "https://your-dashboard.com"
                                },
                                color: "#33b5e5"
                            }
                        ]
                    }
                }
            };
        }

        // Display sent message in preview
        function displaySentMessage(message) {
            const flexPreview = document.getElementById('flexPreview');
            const flexCode = document.getElementById('flexCode');
            const flexBubble = document.getElementById('flexBubble');
            
            if (flexPreview) {
                flexPreview.style.display = 'grid';
            }
            
            if (flexCode) {
                flexCode.textContent = JSON.stringify(message, null, 2);
            }
            
            if (flexBubble && message.contents) {
                const bubble = createFlexBubbleHTML(message.contents);
                flexBubble.innerHTML = bubble;
            }
        }

        // Show troubleshooting tips
        function showTroubleshootingTips(errorMessage) {
            let tips = [];
            
            if (errorMessage.includes('401')) {
                tips = [
                    'üîë ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Channel Access Token ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    '‚è∞ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Token ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏',
                    'üîß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á Bot ‡πÉ‡∏ô LINE Console'
                ];
            } else if (errorMessage.includes('400')) {
                tips = [
                    'üë§ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö User ID ‡∏´‡∏£‡∏∑‡∏≠ Group ID ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    'üí¨ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                    'üë• ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Bot ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß'
                ];
            } else if (errorMessage.includes('403')) {
                tips = [
                    'üö´ Bot ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ',
                    'üë• ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ö‡∏•‡πá‡∏≠‡∏Å Bot ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà',
                    'üîß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Bot ‡πÉ‡∏ô LINE Console'
                ];
            } else if (errorMessage.includes('429')) {
                tips = [
                    '‚è±Ô∏è ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà',
                    'üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Rate Limit ‡∏Ç‡∏≠‡∏á API',
                    '‚öñÔ∏è ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°'
                ];
            } else {
                tips = [
                    'üåê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï',
                    'üîß ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Development ‡πÄ‡∏õ‡πá‡∏ô Production mode',
                    'üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LOG ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'
                ];
            }
            
            addLog('üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:', 'info');
            tips.forEach(tip => {
                addLog(`   ${tip}`, 'info');
            });
        }

        // Validate LINE API credentials
        async function validateCredentials() {
            const tokenElement = document.getElementById('accessToken');
            const token = tokenElement ? tokenElement.value : '';
            
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return false;
            }
            
            try {
                addLog('üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á Token...', 'info');
                
                // Try to get quota (simple API call to validate token)
                const response = await fetch('https://api.line.me/v2/bot/message/quota', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    addLog('‚úÖ Token ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ', 'success');
                    showNotification('‚úÖ Token ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'success');
                    return true;
                } else {
                    throw new Error(`Token validation failed: ${response.status}`);
                }
                
            } catch (error) {
                addLog(`‚ùå Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${error.message}`, 'error');
                showNotification('‚ùå Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏', 'error');
                return false;
            }
        }

        // Create alert message (Text + Flex Message)
        function createAlertMessage(usagePercent, threshold) {
            const theme = usagePercent >= 90 ? 'danger' : 'warning';
            const flexMessage = createAlertFlexMessage(usagePercent, threshold, theme);
            
            return {
                type: "flex",
                altText: `üö® ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô LINE API: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${usagePercent.toFixed(1)}% ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå ${threshold}%`,
                contents: flexMessage
            };
        }

        // Create detailed Flex Message for alerts
        function createAlertFlexMessage(usagePercent, threshold, theme = 'warning') {
            const themeConfig = {
                warning: {
                    headerBg: '#fff3cd',
                    headerColor: '#856404',
                    accentColor: '#ffbb33',
                    icon: '‚ö†Ô∏è',
                    title: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'
                },
                danger: {
                    headerBg: '#f8d7da',
                    headerColor: '#721c24',
                    accentColor: '#ff4444',
                    icon: 'üö®',
                    title: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô!'
                }
            };
            
            const config = themeConfig[theme];
            const currentTime = new Date().toLocaleString('th-TH');
            
            return {
                type: "bubble",
                size: "kilo",
                header: {
                    type: "box",
                    layout: "vertical",
                    contents: [
                        {
                            type: "text",
                            text: `${config.icon} ${config.title}`,
                            weight: "bold",
                            color: config.headerColor,
                            size: "lg"
                        },
                        {
                            type: "text",
                            text: "LINE Messaging API Monitor",
                            size: "sm",
                            color: "#666666"
                        }
                    ],
                    paddingAll: "20px",
                    backgroundColor: config.headerBg
                },
                body: {
                    type: "box",
                    layout: "vertical",
                    contents: [
                        {
                            type: "text",
                            text: `‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô API ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ${usagePercent.toFixed(1)}% ‡πÅ‡∏•‡πâ‡∏ß`,
                            weight: "bold",
                            size: "md",
                            wrap: true,
                            color: config.accentColor
                        },
                        {
                            type: "separator",
                            margin: "md"
                        },
                        {
                            type: "box",
                            layout: "vertical",
                            margin: "md",
                            spacing: "sm",
                            contents: [
                                {
                                    type: "box",
                                    layout: "baseline",
                                    spacing: "sm",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:",
                                            color: "#666666",
                                            size: "sm",
                                            flex: 3
                                        },
                                        {
                                            type: "text",
                                            text: usagePercent.toFixed(1) + "%",
                                            weight: "bold",
                                            size: "sm",
                                            flex: 4,
                                            color: config.accentColor
                                        }
                                    ]
                                },
                                {
                                    type: "box",
                                    layout: "baseline",
                                    spacing: "sm",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "üéØ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå:",
                                            color: "#666666",
                                            size: "sm",
                                            flex: 3
                                        },
                                        {
                                            type: "text",
                                            text: threshold + "%",
                                            weight: "bold",
                                            size: "sm",
                                            flex: 4
                                        }
                                    ]
                                },
                                {
                                    type: "box",
                                    layout: "baseline",
                                    spacing: "sm",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "üìà ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß:",
                                            color: "#666666",
                                            size: "sm",
                                            flex: 3
                                        },
                                        {
                                            type: "text",
                                            text: currentData.usage.totalUsage.toLocaleString(),
                                            weight: "bold",
                                            size: "sm",
                                            flex: 4
                                        }
                                    ]
                                },
                                {
                                    type: "box",
                                    layout: "baseline",
                                    spacing: "sm",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "üí≥ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:",
                                            color: "#666666",
                                            size: "sm",
                                            flex: 3
                                        },
                                        {
                                            type: "text",
                                            text: currentData.quota.value.toLocaleString(),
                                            weight: "bold",
                                            size: "sm",
                                            flex: 4
                                        }
                                    ]
                                },
                                {
                                    type: "box",
                                    layout: "baseline",
                                    spacing: "sm",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤:",
                                            color: "#666666",
                                            size: "sm",
                                            flex: 3
                                        },
                                        {
                                            type: "text",
                                            text: currentTime,
                                            weight: "bold",
                                            size: "sm",
                                            flex: 4,
                                            wrap: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            type: "separator",
                            margin: "md"
                        },
                        {
                            type: "box",
                            layout: "vertical",
                            margin: "md",
                            contents: [
                                {
                                    type: "text",
                                    text: "üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:",
                                    weight: "bold",
                                    size: "sm",
                                    color: "#333333"
                                },
                                {
                                    type: "text",
                                    text: `‚Ä¢ Reply: ${currentData.delivery?.reply?.success || 0} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°\n‚Ä¢ Push: ${currentData.delivery?.push?.success || 0} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°\n‚Ä¢ Multicast: ${currentData.delivery?.multicast?.success || 0} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°\n‚Ä¢ Broadcast: ${currentData.delivery?.broadcast?.success || 0} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°`,
                                    size: "xs",
                                    color: "#666666",
                                    wrap: true,
                                    margin: "sm"
                                }
                            ]
                        }
                    ]
                },
                footer: {
                    type: "box",
                    layout: "vertical",
                    spacing: "sm",
                    contents: [
                        {
                            type: "button",
                            style: "primary",
                            height: "sm",
                            action: {
                                type: "uri",
                                label: "üîó ‡πÄ‡∏õ‡∏¥‡∏î LINE Console",
                                uri: "https://developers.line.biz/console/"
                            },
                            color: config.accentColor
                        },
                        {
                            type: "button",
                            style: "secondary",
                            height: "sm",
                            action: {
                                type: "uri",
                                label: "üìä ‡∏î‡∏π Dashboard",
                                uri: "https://your-dashboard.com"
                            }
                        }
                    ],
                    flex: 0
                }
            };
        }

        // Test alert function with real API
        async function sendTestAlert() {
            const tokenElement = document.getElementById('accessToken');
            const userIdElement = document.getElementById('alertUserId');
            const groupIdElement = document.getElementById('alertGroupId');
            const modeElement = document.getElementById('workingMode');
            
            const token = tokenElement ? tokenElement.value : '';
            const userId = userIdElement ? userIdElement.value : '';
            const groupId = groupIdElement ? groupIdElement.value : '';
            const mode = modeElement ? modeElement.value : 'development';
            
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }
            
            if (!userId && !groupId) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà User ID ‡∏´‡∏£‡∏∑‡∏≠ Group ID', 'error');
                return;
            }
            
            const targetId = groupId || userId;
            const targetType = groupId ? '‡∏Å‡∏•‡∏∏‡πà‡∏°' : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
            
            try {
                addLog(`üß™ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${targetType}...`, 'info');
                
                const testMessage = createTestMessage();
                
                const pushData = {
                    to: targetId,
                    messages: [testMessage]
                };
                
                if (mode === 'production') {
                    // Real API call
                    const response = await fetch('https://api.line.me/v2/bot/message/push', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(pushData)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                    }
                    
                    const result = await response.json();
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Production)`, 'success');
                    addLog(`üìÑ Response: ${JSON.stringify(result)}`, 'info');
                } else {
                    // Development mode
                    await simulateApiCall(1000);
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Development Mode)`, 'success');
                }
                
                showNotification('üß™ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
                // Show test message in preview
                displaySentMessage(testMessage);
                
            } catch (error) {
                addLog(`‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                showNotification('‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message, 'error');
                
                // Show troubleshooting tips
                showTroubleshootingTips(error.message);
            }
        }

        // Flex Message Generator
        function generateFlexMessage() {
            if (!currentData.quota || !currentData.usage) {
                showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message', 'error');
                return;
            }
            
            const usagePercent = (currentData.usage.totalUsage / currentData.quota.value) * 100;
            const threshold = parseInt(document.getElementById('alertThreshold').value);
            const theme = document.getElementById('flexTheme').value;
            const customMessage = document.getElementById('customMessage').value;
            
            const themeColors = {
                warning: { bg: '#fff3cd', color: '#856404', accent: '#ffbb33' },
                danger: { bg: '#f8d7da', color: '#721c24', accent: '#ff4444' },
                info: { bg: '#d1ecf1', color: '#0c5460', accent: '#33b5e5' },
                success: { bg: '#d4edda', color: '#155724', accent: '#00c851' }
            };
            
            const selectedTheme = themeColors[theme];
            
            const flexMessage = {
                type: "flex",
                altText: "üö® ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô LINE Messaging API",
                contents: {
                    type: "bubble",
                    size: "kilo",
                    header: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: getAlertIcon(theme) + " ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô",
                                weight: "bold",
                                color: selectedTheme.color,
                                size: "lg"
                            },
                            {
                                type: "text",
                                text: "LINE Messaging API Monitor",
                                size: "sm",
                                color: "#666666"
                            }
                        ],
                        paddingAll: "20px",
                        backgroundColor: selectedTheme.bg
                    },
                    body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: customMessage || getDefaultMessage(theme, usagePercent),
                                weight: "bold",
                                size: "md",
                                wrap: true,
                                margin: "none"
                            },
                            {
                                type: "separator",
                                margin: "md"
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                margin: "md",
                                spacing: "sm",
                                contents: [
                                    createFlexRow("üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:", usagePercent.toFixed(1) + "%", selectedTheme.accent),
                                    createFlexRow("üéØ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå:", threshold + "%", "#666666"),
                                    createFlexRow("üìà ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß:", currentData.usage.totalUsage.toLocaleString(), "#666666"),
                                    createFlexRow("üí≥ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:", currentData.quota.value.toLocaleString(), "#666666"),
                                    createFlexRow("üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:", new Date().toLocaleDateString('th-TH'), "#666666")
                                ]
                            }
                        ]
                    },
                    footer: {
                        type: "box",
                        layout: "vertical",
                        spacing: "sm",
                        contents: [
                            {
                                type: "button",
                                style: "primary",
                                height: "sm",
                                action: {
                                    type: "uri",
                                    label: "üîó ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î",
                                    uri: "https://developers.line.biz/console/"
                                },
                                color: selectedTheme.accent
                            },
                            {
                                type: "button",
                                style: "secondary",
                                height: "sm",
                                action: {
                                    type: "uri",
                                    label: "üìä Dashboard",
                                    uri: "https://your-dashboard.com"
                                }
                            }
                        ],
                        flex: 0
                    }
                }
            };
            
            // Display the flex message
            displayFlexMessage(flexMessage);
            addLog('üì± ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        function createFlexRow(label, value, valueColor = "#333333") {
            return {
                type: "box",
                layout: "baseline",
                spacing: "sm",
                contents: [
                    {
                        type: "text",
                        text: label,
                        color: "#666666",
                        size: "sm",
                        flex: 3
                    },
                    {
                        type: "text",
                        text: value,
                        weight: "bold",
                        size: "sm",
                        flex: 4,
                        color: valueColor
                    }
                ]
            };
        }

        function getAlertIcon(theme) {
            const icons = {
                warning: "‚ö†Ô∏è",
                danger: "üö®",
                info: "‚ÑπÔ∏è",
                success: "‚úÖ"
            };
            return icons[theme] || "üîî";
        }

        function getDefaultMessage(theme, usagePercent) {
            const messages = {
                warning: `‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ${usagePercent.toFixed(1)}% ‡πÅ‡∏•‡πâ‡∏ß`,
                danger: `‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏ï‡πá‡∏°! ${usagePercent.toFixed(1)}%`,
                info: `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${usagePercent.toFixed(1)}%`,
                success: `‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥: ${usagePercent.toFixed(1)}%`
            };
            return messages[theme] || `‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${usagePercent.toFixed(1)}%`;
        }

        function displayFlexMessage(flexMessage) {
            // Show the preview section
            document.getElementById('flexPreview').style.display = 'grid';
            
            // Create visual preview
            const bubble = createFlexBubbleHTML(flexMessage.contents);
            document.getElementById('flexBubble').innerHTML = bubble;
            
            // Show JSON code
            document.getElementById('flexCode').textContent = JSON.stringify(flexMessage, null, 2);
        }

        function createFlexBubbleHTML(contents) {
            const header = contents.header;
            const body = contents.body;
            const footer = contents.footer;
            
            return `
                <div class="flex-header" style="background: ${header.backgroundColor}">
                    <div style="color: ${header.contents[0].color}; font-weight: bold; font-size: 1.1em;">
                        ${header.contents[0].text}
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        ${header.contents[1].text}
                    </div>
                </div>
                <div class="flex-body">
                    <div style="font-weight: bold; margin-bottom: 15px;">
                        ${body.contents[0].text}
                    </div>
                    <hr style="margin: 15px 0; border: none; border-top: 1px solid #eee;">
                    <div style="font-size: 0.9em;">
                        ${body.contents[2].contents.map(row => `
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span style="color: #666;">${row.contents[0].text}</span>
                                <strong style="color: ${row.contents[1].color || '#333'};">${row.contents[1].text}</strong>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="flex-footer">
                    ${footer.contents.map(button => `
                        <button class="flex-button" style="background: ${button.color || '#00c851'}; margin-bottom: 8px;">
                            ${button.action.label}
                        </button>
                    `).join('')}
                </div>
            `;
        }

        function copyFlexMessage() {
            const flexCode = document.getElementById('flexCode').textContent;
            navigator.clipboard.writeText(flexCode).then(() => {
                showNotification('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                addLog('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Flex Message JSON', 'info');
            }).catch(err => {
                showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ', 'error');
            });
        }

        // Utility functions
        async function simulateApiCall(delay) {
            return new Promise(resolve => setTimeout(resolve, delay));
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            if (statusElement) {
                const statusTexts = {
                    connecting: 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...',
                    connected: '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß',
                    error: '‚ùå ‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠',
                    disconnected: '‚ö™ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'
                };
                statusElement.textContent = statusTexts[status] || status;
            }
        }

        function updateLastUpdate() {
            const lastUpdateElement = document.getElementById('lastUpdate');
            if (lastUpdateElement) {
                const now = new Date().toLocaleTimeString('th-TH');
                lastUpdateElement.textContent = now;
            }
        }

        async function testConnection() {
            const token = document.getElementById('accessToken').value;
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }

            addLog('üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API...', 'info');
            updateConnectionStatus('connecting');

            try {
                // Simulate connection test
                await simulateApiCall(2000);
                updateConnectionStatus('connected');
                showNotification('‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                addLog('‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                updateConnectionStatus('error');
                showNotification('‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                addLog('‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message, 'error');
            }
        }

        function exportData() {
            if (!currentData.quota && !currentData.usage) {
                showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'error');
                return;
            }

            const exportData = {
                timestamp: new Date().toISOString(),
                quota: currentData.quota,
                usage: currentData.usage,
                delivery: currentData.delivery,
                insight: currentData.insight,
                settings: {
                    alertThreshold: document.getElementById('alertThreshold').value,
                    webhookUrl: document.getElementById('webhookUrl').value,
                    workingMode: document.getElementById('workingMode').value
                }
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `line-api-data-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            addLog('üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå JSON', 'info');
        }

        function clearData() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                currentData = {};
                apiCallsToday = 0;
                
                // Reset all metric cards
                const metrics = ['quota', 'usage', 'reply', 'push', 'multicast', 'broadcast'];
                metrics.forEach(metric => {
                    document.getElementById(`${metric}Value`).textContent = '-';
                    document.getElementById(`${metric}Status`).className = 'status-indicator status-loading';
                    document.getElementById(`${metric}StatusText`).textContent = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                    const progress = document.getElementById(`${metric}Progress`);
                    if (progress) {
                        progress.style.width = '0%';
                        progress.style.background = 'linear-gradient(45deg, #00c851, #00b341)';
                    }
                });

                // Reset status bar
                document.getElementById('connectionStatus').textContent = '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
                document.getElementById('lastUpdate').textContent = '-';
                document.getElementById('apiCallsCount').textContent = '0';
                document.getElementById('rateLimit').textContent = '-';

                // Hide flex preview
                document.getElementById('flexPreview').style.display = 'none';

                showNotification('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
                addLog('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 'info');
            }
        }

        async function sendWebhookAlert(url, usagePercent, threshold) {
            try {
                addLog(`üì° ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Webhook...`, 'info');
                
                const payload = {
                    alert: 'high_usage',
                    timestamp: new Date().toISOString(),
                    usage_percent: usagePercent,
                    threshold: threshold,
                    current_usage: currentData.usage.totalUsage,
                    quota: currentData.quota.value,
                    message: `‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô LINE Messaging API ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ${usagePercent.toFixed(1)}% ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå ${threshold}%`
                };

                // Simulate webhook call (in real implementation, use fetch to send data)
                await simulateApiCall(1000);
                
                addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Webhook ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                showNotification('üì° ‡∏™‡πà‡∏á Webhook Alert ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
            } catch (error) {
                addLog(`‚ùå ‡∏™‡πà‡∏á Webhook ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                showNotification('‚ùå ‡∏™‡πà‡∏á Webhook ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
            }
        }

        // Auto-update functionality
        function toggleAutoUpdate() {
            const interval = document.getElementById('updateInterval').value;
            
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
                addLog('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥', 'info');
            }
            
            if (interval !== 'manual') {
                updateInterval = setInterval(() => {
                    addLog('üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...', 'info');
                    fetchAllData();
                }, parseInt(interval));
                
                addLog(`‚è∞ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å ${interval/1000} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`, 'info');
            }
        }

        // Event listeners
        document.getElementById('updateInterval').addEventListener('change', toggleAutoUpdate);

        // Advanced Analytics Functions
        function initializeCharts() {
            // This would initialize Chart.js charts in a real implementation
            addLog('üìä ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≤‡∏ü Analytics', 'info');
            
            // Simulate chart data
            setTimeout(() => {
                document.getElementById('avgResponseTime').textContent = Math.floor(Math.random() * 200 + 50);
                document.getElementById('successRate').textContent = (Math.random() * 5 + 95).toFixed(1);
                document.getElementById('errorRate').textContent = (Math.random() * 2 + 0.5).toFixed(1);
                document.getElementById('uptime').textContent = (Math.random() * 2 + 98).toFixed(1);
            }, 3000);
        }

        // Log management
        function addLog(message, type = 'info') {
            const now = new Date().toLocaleTimeString('th-TH');
            const logEntry = {
                timestamp: now,
                message: message,
                type: type
            };
            
            logEntries.push(logEntry);
            
            // Keep only last 50 entries
            if (logEntries.length > 50) {
                logEntries.shift();
            }
            
            // Update log display
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const container = document.getElementById('logContainer');
            const latestEntries = logEntries.slice(-10).reverse(); // Show last 10 entries
            
            container.innerHTML = latestEntries.map(entry => `
                <div class="log-entry log-${entry.type}">
                    [${entry.timestamp}] ${entry.message}
                </div>
            `).join('');
        }

        function clearLogs() {
            logEntries = [];
            updateLogDisplay();
            addLog('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Log ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
        }

        // Theme toggle
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const button = document.querySelector('.theme-toggle');
            
            if (isDarkMode) {
                document.body.style.filter = 'invert(1) hue-rotate(180deg)';
                button.textContent = '‚òÄÔ∏è';
                addLog('üåô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î', 'info');
            } else {
                document.body.style.filter = 'none';
                button.textContent = 'üåô';
                addLog('‚òÄÔ∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏µ‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á', 'info');
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Rate limit monitoring
        function updateRateLimit() {
            const limits = [
                '2,000/sec (Quota)',
                '2,000/sec (Usage)',
                '2,000/sec (Delivery)',
                '60/hour (Insight)'
            ];
            
            const randomLimit = limits[Math.floor(Math.random() * limits.length)];
            document.getElementById('rateLimit').textContent = randomLimit;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'r':
                        e.preventDefault();
                        fetchAllData();
                        break;
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                    case 'l':
                        e.preventDefault();
                        clearLogs();
                        break;
                }
            }
        });

        // Initialize advanced features
        setTimeout(() => {
            initializeCharts();
            updateRateLimit();
            
            // Simulate some activity
            setTimeout(() => addLog('üéØ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success'), 1000);
            setTimeout(() => addLog('üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÉ‡∏ä‡πâ Ctrl+R ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'info'), 2000);
            setTimeout(() => addLog('üìö ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô API ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏ú‡∏á API Endpoints', 'info'), 3000);
        }, 1000);

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>
