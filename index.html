<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE Messaging API Dashboard - Advanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans Thai', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 30px 0;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .header .features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .feature-tag {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        .config-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .config-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        .config-header h2 {
            color: #333;
            font-size: 1.5em;
            margin-left: 10px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.95em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-hint {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #00c851, #00b341);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffbb33, #ff8800);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status-bar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .status-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .status-item .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .status-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .status-item .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .metrics-section {
            display: grid;
            gap: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .metric-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .metric-icon {
            font-size: 1.5em;
            opacity: 0.7;
        }

        .metric-value {
            font-size: 2.8em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .metric-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
        }

        .metric-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-ready { background: #00c851; }
        .status-unready { background: #ff4444; }
        .status-loading { background: #ffbb33; }
        .status-error { background: #ff6b6b; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .metric-progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .metric-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #00c851, #00b341);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .sidebar {
            display: grid;
            gap: 20px;
        }

        .alert-panel {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .alert-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .alert-header h3 {
            margin-left: 10px;
            color: #333;
        }

        .alert-config {
            margin-bottom: 20px;
        }

        .alert-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #ffbb33;
        }

        .alert-item.active {
            border-left-color: #ff4444;
            background: #fff5f5;
        }

        .api-panel {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .api-endpoint {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
        }

        .api-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 10px;
        }

        .api-method.get { background: #28a745; color: white; }
        .api-method.post { background: #007bff; color: white; }

        .api-url {
            color: #333;
            font-size: 0.9em;
            word-break: break-all;
        }

        .api-description {
            font-size: 0.85em;
            color: #666;
            margin-top: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .flex-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .flex-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .flex-visual {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px dashed #dee2e6;
        }

        .flex-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .flex-bubble {
            max-width: 300px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: hidden;
            margin: 0 auto;
        }

        .flex-header {
            background: #fff5f5;
            padding: 20px;
            text-align: center;
        }

        .flex-body {
            padding: 20px;
        }

        .flex-footer {
            padding: 15px 20px;
        }

        .flex-button {
            width: 100%;
            padding: 12px;
            background: #00c851;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .log-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
        }

        .log-info { background: #d1ecf1; color: #0c5460; }
        .log-success { background: #d4edda; color: #155724; }
        .log-error { background: #f8d7da; color: #721c24; }
        .log-warning { background: #fff3cd; color: #856404; }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: #00c851; }
        .notification.error { background: #ff4444; }
        .notification.warning { background: #ffbb33; }
        .notification.info { background: #33b5e5; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .flex-preview {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .header h1 {
                font-size: 2.2em;
            }
            .header .features {
                gap: 15px;
            }
            .config-grid {
                grid-template-columns: 1fr;
            }
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            .btn-group {
                flex-direction: column;
            }
            .status-items {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .metric-value {
                font-size: 2.2em;
            }
            .status-items {
                grid-template-columns: 1fr;
            }
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50px;
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>

    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>üöÄ LINE Messaging API Dashboard</h1>
            <p class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE Official Account ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô</p>
            <div class="features">
                <span class="feature-tag">üìä Real-time Monitoring</span>
                <span class="feature-tag">üîî Smart Alerts</span>
                <span class="feature-tag">üì± Flex Messages</span>
                <span class="feature-tag">üìà Analytics</span>
                <span class="feature-tag">‚ö° API Testing</span>
            </div>
        </div>

        <!-- Configuration Panel -->
        <div class="config-panel">
            <div class="config-header">
                <span style="font-size: 1.5em;">‚öôÔ∏è</span>
                <h2>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
            </div>
            
            <div class="config-grid">
                <div class="form-group">
                    <label>üîë Channel Access Token</label>
                    <input type="password" id="accessToken" placeholder="‡πÉ‡∏™‡πà Channel Access Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    <div class="input-hint">Token ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                
                <div class="form-group">
                    <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                    <input type="text" id="dateInput" placeholder="YYYYMMDD ‡πÄ‡∏ä‡πà‡∏ô 20250710">
                    <div class="input-hint">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: YYYYMMDD (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 31 ‡∏°‡∏µ.‡∏Ñ. 2018)</div>
                </div>
                
                <div class="form-group">
                    <label>‚è±Ô∏è ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</label>
                    <select id="updateInterval">
                        <option value="manual">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</option>
                        <option value="30000">‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                        <option value="60000">‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                        <option value="300000">‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                        <option value="900000">‡∏ó‡∏∏‡∏Å 15 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                    </select>
                    <div class="input-hint">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</div>
                </div>
                
                <div class="form-group">
                    <label>üéØ ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
                    <select id="workingMode">
                        <option value="development">Development (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</option>
                        <option value="production">Production (API ‡∏à‡∏£‡∏¥‡∏á)</option>
                    </select>
                    <div class="input-hint">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="fetchAllData()">
                    <span id="fetchIcon">üîÑ</span> ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button class="btn btn-success" onclick="testConnection()">
                    üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
                <button class="btn btn-primary" onclick="validateCredentials()">
                    üîë ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Token
                </button>
                <button class="btn btn-warning" onclick="exportData()">
                    üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button class="btn" onclick="clearData()" style="background: #6c757d; color: white;">
                    üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-items">
                <div class="status-item">
                    <div class="icon">üåê</div>
                    <div class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
                    <div class="value" id="connectionStatus">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
                </div>
                <div class="status-item">
                    <div class="icon">‚è∞</div>
                    <div class="label">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                    <div class="value" id="lastUpdate">-</div>
                </div>
                <div class="status-item">
                    <div class="icon">üìä</div>
                    <div class="label">API Calls ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="value" id="apiCallsCount">0</div>
                </div>
                <div class="status-item">
                    <div class="icon">‚ö°</div>
                    <div class="label">Rate Limit</div>
                    <div class="value" id="rateLimit">-</div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard-grid">
            <!-- Metrics Section -->
            <div class="metrics-section">
                <div class="metrics-grid" id="metricsGrid">
                    <!-- Quota Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ</div>
                            <div class="metric-icon">üí≥</div>
                        </div>
                        <div class="metric-value" id="quotaValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="quotaStatus"></span>
                                <span id="quotaStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                        <div class="metric-progress">
                            <div class="metric-progress-bar" style="width: 0%" id="quotaProgress"></div>
                        </div>
                    </div>

                    <!-- Usage Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üìà ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</div>
                            <div class="metric-icon">‚ö°</div>
                        </div>
                        <div class="metric-value" id="usageValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">Real-time Usage</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="usageStatus"></span>
                                <span id="usagePercentage">0%</span>
                            </div>
                        </div>
                        <div class="metric-progress">
                            <div class="metric-progress-bar" style="width: 0%" id="usageProgress"></div>
                        </div>
                    </div>

                    <!-- Reply Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üí¨ Reply Messages</div>
                            <div class="metric-icon">‚Ü©Ô∏è</div>
                        </div>
                        <div class="metric-value" id="replyValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="replyStatus"></span>
                                <span id="replyStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>

                    <!-- Push Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üì§ Push Messages</div>
                            <div class="metric-icon">üì¨</div>
                        </div>
                        <div class="metric-value" id="pushValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∏‡∏ä</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="pushStatus"></span>
                                <span id="pushStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>

                    <!-- Multicast Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üì° Multicast Messages</div>
                            <div class="metric-icon">üìª</div>
                        </div>
                        <div class="metric-value" id="multicastValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="multicastStatus"></span>
                                <span id="multicastStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>

                    <!-- Broadcast Messages Card -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">üì¢ Broadcast Messages</div>
                            <div class="metric-icon">üì∫</div>
                        </div>
                        <div class="metric-value" id="broadcastValue">-</div>
                        <div class="metric-details">
                            <div class="metric-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</div>
                            <div class="metric-status">
                                <span class="status-indicator status-loading" id="broadcastStatus"></span>
                                <span id="broadcastStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Alert Panel -->
                <div class="alert-panel">
                    <div class="alert-header">
                        <span style="font-size: 1.5em;">üîî</span>
                        <h3>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    </div>
                    
                    <div class="alert-config">
                        <div class="form-group">
                            <label>üéØ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (%)</label>
                            <input type="number" id="alertThreshold" value="80" min="1" max="100">
                            <div class="input-hint">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ô‡∏µ‡πâ</div>
                        </div>
                        
                        <div class="form-group">
                            <label>üåê Webhook URL</label>
                            <input type="url" id="webhookUrl" placeholder="https://your-webhook.com">
                            <div class="input-hint">URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                        </div>
                        
                        <div class="form-group">
                            <label>üë§ User ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                            <input type="text" id="alertUserId" placeholder="U1234567890abcdef1234567890abcdef">
                            <div class="input-hint">User ID ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Push Message)</div>
                        </div>
                        
                        <div class="form-group">
                            <label>üë• Group ID (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                            <input type="text" id="alertGroupId" placeholder="C1234567890abcdef1234567890abcdef">
                            <div class="input-hint">Group ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-warning" onclick="checkAlerts()" style="width: 100%; margin-bottom: 15px;">
                        üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </button>
                    
                    <button class="btn btn-primary" onclick="sendTestAlert()" style="width: 100%; margin-bottom: 15px;">
                        üì± ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    </button>
                    
                    <div id="alertsList">
                        <div class="alert-item">
                            <div>
                                <strong>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á</strong><br>
                                <small>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 80%</small>
                            </div>
                            <span id="alertStatus1">üò¥</span>
                        </div>
                        
                        <div class="alert-item">
                            <div>
                                <strong>Rate Limit</strong><br>
                                <small>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î</small>
                            </div>
                            <span id="alertStatus2">üò¥</span>
                        </div>
                        
                        <div class="alert-item">
                            <div>
                                <strong>User ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</strong><br>
                                <small>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö User ID ‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà</small>
                            </div>
                            <span id="alertStatus4">üò¥</span>
                        </div>
                    </div>
                </div>

                <!-- API Endpoints Panel -->
                <div class="api-panel">
                    <div class="alert-header">
                        <span style="font-size: 1.5em;">üîó</span>
                        <h3>API Endpoints</h3>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/quota</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/quota/consumption</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏ö‡∏ö Real-time</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method post">POST</span>
                        <div class="api-url">/v2/bot/message/push</div>
                        <div class="api-description">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á User ID</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/delivery/reply</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Reply Messages</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/delivery/multicast</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Multicast Messages</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/message/delivery/broadcast</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Broadcast Messages</div>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="api-method get">GET</span>
                        <div class="api-url">/v2/bot/insight/message/delivery</div>
                        <div class="api-description">‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flex Message Section -->
        <div class="flex-section">
            <div class="alert-header">
                <span style="font-size: 1.5em;">üì±</span>
                <h3>Flex Message Generator</h3>
            </div>
            
            <div class="config-grid" style="margin-bottom: 20px;">
                <div class="form-group">
                    <label>üé® ‡∏ò‡∏µ‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                    <select id="flexTheme">
                        <option value="warning">‚ö†Ô∏è Warning (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)</option>
                        <option value="danger">üö® Danger (‡∏™‡∏µ‡πÅ‡∏î‡∏á)</option>
                        <option value="info">‚ÑπÔ∏è Info (‡∏™‡∏µ‡∏ü‡πâ‡∏≤)</option>
                        <option value="success">‚úÖ Success (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                    <input type="text" id="customMessage" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="generateFlexMessage()" style="margin-bottom: 20px;">
                üé® ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message
            </button>
            
            <div class="flex-preview" id="flexPreview" style="display: none;">
                <div class="flex-visual">
                    <h4>üëÄ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Flex Message</h4>
                    <div class="flex-bubble" id="flexBubble">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>
                
                <div>
                    <h4>üíª JSON Code</h4>
                    <div class="flex-code" id="flexCode">
                        <!-- JSON code will be inserted here -->
                    </div>
                    <button class="btn btn-success" onclick="copyFlexMessage()" style="margin-top: 15px; width: 100%;">
                        üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON
                    </button>
                </div>
            </div>
        </div>

        <!-- Log Section -->
        <div class="log-section">
            <div class="alert-header">
                <span style="font-size: 1.5em;">üìù</span>
                <h3>‡∏£‡∏∞‡∏ö‡∏ö Log ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                <button class="btn" onclick="clearLogs()" style="margin-left: auto; background: #6c757d; color: white;">
                    üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Log
                </button>
            </div>
            
            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">
                    [<span id="currentTime"></span>] üìã ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentData = {};
        let updateInterval = null;
        let logEntries = [];
        let apiCallsToday = 0;
        let isDarkMode = false;

        // Initialize the application
        window.onload = function() {
            initializeApp();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        };

        function initializeApp() {
            // Set default date
            const today = new Date();
            const dateString = today.getFullYear() + 
                              String(today.getMonth() + 1).padStart(2, '0') + 
                              String(today.getDate()).padStart(2, '0');
            document.getElementById('dateInput').value = dateString;
            
            // Set demo token
            document.getElementById('accessToken').value = 'your-channel-access-token-here';
            
            addLog('üìã ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', 'info');
            addLog('‚öôÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...', 'info');
            
            // Auto-load demo data after 2 seconds
            setTimeout(() => {
                addLog('üé≠ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'info');
                fetchAllData();
            }, 2000);
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('th-TH');
            document.getElementById('currentTime').textContent = timeString;
        }

        // Simulate API call delay
        async function simulateApiCall(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Add log entry
        function addLog(message, type) {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleString('th-TH')}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            logEntries.push(logEntry);
            if (logEntries.length > 50) {
                logEntries.shift().remove();
            }
        }

        // Clear logs
        function clearLogs() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '';
            logEntries = [];
            addLog('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Log ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'info');
        }

        // Update connection status
        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            const statusMap = {
                connecting: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...',
                connected: '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß',
                error: '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'
            };
            statusElement.textContent = statusMap[status] || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
        }

        // Update last update time
        function updateLastUpdate() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('th-TH');
        }

        // Main data fetching function
        async function fetchAllData() {
            const token = document.getElementById('accessToken').value;
            const date = document.getElementById('dateInput').value;
            const mode = document.getElementById('workingMode').value;

            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }

            if (!date || !/^\d{8}$/.test(date)) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYYMMDD', 'error');
                return;
            }

            document.getElementById('fetchIcon').innerHTML = '<div class="loading"></div>';
            document.querySelector('[onclick="fetchAllData()"]').disabled = true;
            updateConnectionStatus('connecting');
            addLog('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...', 'info');

            try {
                await fetchWithProgress('quota', fetchQuota, token);
                await fetchWithProgress('usage', fetchUsage, token);
                await fetchWithProgress('delivery', fetchDeliveryStats, token, date);
                await fetchWithProgress('insight', fetchInsightData, token, date);
                
                updateConnectionStatus('connected');
                updateLastUpdate();
                apiCallsToday += 7;
                document.getElementById('apiCallsCount').textContent = apiCallsToday;
                showNotification('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                addLog('‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
                
                setTimeout(checkAlerts, 1000);
            } catch (error) {
                updateConnectionStatus('error');
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                addLog('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            } finally {
                document.getElementById('fetchIcon').textContent = 'üîÑ';
                document.querySelector('[onclick="fetchAllData()"]').disabled = false;
            }
        }

        async function fetchWithProgress(type, fetchFunction, ...args) {
            addLog(`üì° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${type}...`, 'info');
            await fetchFunction(...args);
            addLog(`‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${type} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
        }

        // Simulated API fetch functions
        async function fetchQuota(token) {
            await simulateApiCall(800);
            const mockData = {
                type: "limited",
                value: 15000
            };
            currentData.quota = mockData;
            updateMetricCard('quota', mockData.value, 'üìä ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', 'ready', 100);
        }

        async function fetchUsage(token) {
            await simulateApiCall(600);
            const mockData = {
                totalUsage: Math.floor(Math.random() * 12000) + 4000
            };
            currentData.usage = mockData;
            const percentage = currentData.quota ? (mockData.totalUsage / currentData.quota.value) * 100 : 0;
            updateMetricCard('usage', mockData.totalUsage, `üí° ${percentage.toFixed(1)}% ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô`, 'ready', percentage);
            document.getElementById('usagePercentage').textContent = percentage.toFixed(1) + '%';
        }

        async function fetchDeliveryStats(token, date) {
            await simulateApiCall(1000);
            const mockData = {
                reply: { status: "ready", success: Math.floor(Math.random() * 2000) + 1500 },
                push: { status: "ready", success: Math.floor(Math.random() * 1500) + 800 },
                multicast: { status: "ready", success: Math.floor(Math.random() * 800) + 300 },
                broadcast: { status: "ready", success: Math.floor(Math.random() * 500) + 200 }
            };
            currentData.delivery = mockData;
            Object.keys(mockData).forEach(type => {
                updateMetricCard(type, mockData[type].success, getTypeLabel(type), mockData[type].status);
            });
        }

        async function fetchInsightData(token, date) {
            await simulateApiCall(900);
            const mockData = {
                status: "ready",
                broadcast: Math.floor(Math.random() * 3000) + 2000,
                targeting: Math.floor(Math.random() * 2000) + 1000,
                apiBroadcast: currentData.delivery?.broadcast?.success || 256,
                apiPush: currentData.delivery?.push?.success || 1024,
                apiMulticast: currentData.delivery?.multicast?.success || 512,
                apiReply: currentData.delivery?.reply?.success || 2048
            };
            currentData.insight = mockData;
            addLog('üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Insight: OA Manager + API ‡∏£‡∏ß‡∏°', 'info');
        }

        function updateMetricCard(type, value, label, status, progress = 0) {
            const valueElement = document.getElementById(`${type}Value`);
            const statusElement = document.getElementById(`${type}Status`);
            const statusTextElement = document.getElementById(`${type}StatusText`);
            
            if (valueElement) valueElement.textContent = value.toLocaleString();
            if (statusElement) statusElement.className = `status-indicator status-${status}`;
            if (statusTextElement) statusTextElement.textContent = getStatusText(status);
            
            if (progress > 0) {
                const progressBar = document.getElementById(`${type}Progress`);
                if (progressBar) {
                    progressBar.style.width = Math.min(progress, 100) + '%';
                    if (progress > 80) {
                        progressBar.style.background = 'linear-gradient(45deg, #ff4444, #cc0000)';
                    } else if (progress > 60) {
                        progressBar.style.background = 'linear-gradient(45deg, #ffbb33, #ff8800)';
                    }
                }
            }
        }

        function getTypeLabel(type) {
            const labels = {
                reply: 'üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö',
                push: 'üì§ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∏‡∏ä',
                multicast: 'üì° ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô',
                broadcast: 'üì¢ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®'
            };
            return labels[type] || type;
        }

        function getStatusText(status) {
            const texts = {
                ready: '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                unready: '‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°',
                out_of_service: '‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ',
                loading: 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
                error: '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'
            };
            return texts[status] || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
        }

        // Alert system with LINE Messaging API
        function checkAlerts() {
            if (!currentData.quota || !currentData.usage) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 'error');
                return;
            }
            
            const threshold = parseInt(document.getElementById('alertThreshold').value) || 80;
            const usagePercent = (currentData.usage.totalUsage / currentData.quota.value) * 100;
            
            addLog(`üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${usagePercent.toFixed(1)}% (‡πÄ‡∏Å‡∏ì‡∏ë‡πå: ${threshold}%)`, 'info');
            
            document.getElementById('alertStatus1').textContent = usagePercent >= threshold ? 'üö®' : 'üò¥';
            document.getElementById('alertStatus2').textContent = usagePercent >= 90 ? '‚ö†Ô∏è' : 'üò¥';
            document.getElementById('alertStatus4').textContent = '‚úÖ';
            
            if (usagePercent >= threshold) {
                generateFlexMessage();
                showNotification(`üö® ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${usagePercent.toFixed(1)}% ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå!`, 'warning');
                addLog(`üö® ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${usagePercent.toFixed(1)}%`, 'warning');
                
                sendLineAlert(usagePercent, threshold);
                
                const webhookUrl = document.getElementById('webhookUrl').value;
                if (webhookUrl) {
                    sendWebhookAlert(webhookUrl, usagePercent, threshold);
                }
            } else {
                showNotification(`‚úÖ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏õ‡∏Å‡∏ï‡∏¥ (${usagePercent.toFixed(1)}%)`, 'success');
                addLog(`‚úÖ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥: ${usagePercent.toFixed(1)}%`, 'success');
            }
        }

        // Create detailed Flex Message for alerts
        function createAlertFlexMessage(usagePercent, threshold, theme = 'warning', customMessage = '') {
            const themeConfig = {
                warning: {
                    headerBg: '#fff3cd',
                    headerColor: '#856404',
                    accentColor: '#ffbb33',
                    icon: '‚ö†Ô∏è',
                    title: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'
                },
                danger: {
                    headerBg: '#f8d7da',
                    headerColor: '#721c24',
                    accentColor: '#ff4444',
                    icon: 'üö®',
                    title: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô!'
                },
                info: {
                    headerBg: '#d1ecf1',
                    headerColor: '#0c5460',
                    accentColor: '#33b5e5',
                    icon: '‚ÑπÔ∏è',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'
                },
                success: {
                    headerBg: '#d4edda',
                    headerColor: '#155724',
                    accentColor: '#00c851',
                    icon: '‚úÖ',
                    title: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥'
                }
            };
            
            const config = themeConfig[theme] || themeConfig.warning;
            const currentTime = new Date().toLocaleString('th-TH');
            
            return {
                type: "flex",
                altText: `üö® ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô LINE API: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${usagePercent.toFixed(1)}% ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå ${threshold}%`,
                contents: {
                    type: "bubble",
                    size: "kilo",
                    header: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: `${config.icon} ${config.title}`,
                                weight: "bold",
                                size: "lg",
                                color: config.headerColor,
                                align: "center"
                            }
                        ],
                        backgroundColor: config.headerBg,
                        paddingAll: "20px"
                    },
                    body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: `‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${usagePercent.toFixed(1)}%`,
                                weight: "bold",
                                size: "xl",
                                color: config.accentColor
                            },
                            {
                                type: "text",
                                text: `‡πÄ‡∏Å‡∏ì‡∏ë‡πå: ${threshold}%`,
                                size: "sm",
                                color: "#666666",
                                margin: "md"
                            },
                            {
                                type: "text",
                                text: `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤: ${currentTime}`,
                                size: "sm",
                                color: "#666666",
                                margin: "md"
                            },
                            customMessage ? {
                                type: "text",
                                text: customMessage,
                                size: "sm",
                                color: "#333333",
                                margin: "md",
                                wrap: true
                            } : null,
                            {
                                type: "separator",
                                margin: "lg"
                            },
                            {
                                type: "text",
                                text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£",
                                size: "xs",
                                color: "#999999",
                                align: "center",
                                margin: "lg"
                            }
                        ].filter(Boolean),
                        paddingAll: "20px"
                    },
                    footer: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "button",
                                action: {
                                    type: "uri",
                                    label: "‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î",
                                    uri: "https://your-dashboard-url.com"
                                },
                                style: "primary",
                                color: config.accentColor
                            }
                        ],
                        paddingAll: "15px"
                    }
                }
            };
        }

        // Send alert via LINE Messaging API
        async function sendLineAlert(usagePercent, threshold) {
            const token = document.getElementById('accessToken').value;
            const userId = document.getElementById('alertUserId').value;
            const groupId = document.getElementById('alertGroupId').value;
            const mode = document.getElementById('workingMode').value;
            const theme = document.getElementById('flexTheme').value;
            const customMessage = document.getElementById('customMessage').value;
            
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }
            
            if (!userId && !groupId) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà User ID ‡∏´‡∏£‡∏∑‡∏≠ Group ID', 'error');
                return;
            }
            
            const targetId = groupId || userId;
            const targetType = groupId ? '‡∏Å‡∏•‡∏∏‡πà‡∏°' : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
            
            try {
                addLog(`üì± ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE Messaging API ‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${targetType}...`, 'info');
                
                const flexMessage = createAlertFlexMessage(usagePercent, threshold, theme, customMessage);
                
                const pushData = {
                    to: targetId,
                    messages: [flexMessage]
                };
                
                if (mode === 'production') {
                    const response = await fetch('https://api.line.me/v2/bot/message/push', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(pushData)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const result = await response.json();
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE API ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Production)`, 'success');
                    addLog(`üìÑ Response: ${JSON.stringify(result)}`, 'info');
                } else {
                    await simulateApiCall(1500);
                    addLog(`‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Development Mode)`, 'success');
                }
                
                showNotification('üì± ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                displaySentMessage(flexMessage);
                addLog(`üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á: ${JSON.stringify(pushData, null, 2)}`, 'info');
            } catch (error) {
                addLog(`‚ùå ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                showNotification('‚ùå ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message, 'error');
            }
        }

        // Send webhook alert
        async function sendWebhookAlert(webhookUrl, usagePercent, threshold) {
            try {
                addLog('üåê ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Webhook...', 'info');
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'alert',
                        usagePercent: usagePercent.toFixed(1),
                        threshold,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) throw new Error('Webhook request failed');
                addLog('‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Webhook ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                addLog(`‚ùå ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Webhook ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                showNotification('‚ùå ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Webhook ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
            }
        }

        // Generate and display Flex Message
        function generateFlexMessage() {
            const theme = document.getElementById('flexTheme').value;
            const customMessage = document.getElementById('customMessage').value;
            const usagePercent = currentData.usage && currentData.quota ? 
                (currentData.usage.totalUsage / currentData.quota.value) * 100 : 80;
            const threshold = parseInt(document.getElementById('alertThreshold').value) || 80;
            
            const flexMessage = createAlertFlexMessage(usagePercent, threshold, theme, customMessage);
            
            const flexBubble = document.getElementById('flexBubble');
            const flexCode = document.getElementById('flexCode');
            const flexPreview = document.getElementById('flexPreview');
            
            flexBubble.innerHTML = `
                <div class="flex-header" style="background: ${flexMessage.contents.header.backgroundColor}; color: ${flexMessage.contents.header.contents[0].color}">
                    ${flexMessage.contents.header.contents[0].text}
                </div>
                <div class="flex-body">
                    <div style="font-weight: bold; font-size: 24px; color: ${flexMessage.contents.body.contents[0].color}">
                        ${flexMessage.contents.body.contents[0].text}
                    </div>
                    <div style="margin-top: 10px; color: #666666">${flexMessage.contents.body.contents[1].text}</div>
                    <div style="margin-top: 10px; color: #666666">${flexMessage.contents.body.contents[2].text}</div>
                    ${customMessage ? `<div style="margin-top: 10px; color: #333333">${customMessage}</div>` : ''}
                    <hr style="margin: 15px 0">
                    <div style="text-align: center; color: #999999">${flexMessage.contents.body.contents[flexMessage.contents.body.contents.length - 1].text}</div>
                </div>
                <div class="flex-footer">
                    <button class="flex-button" style="background: ${flexMessage.contents.footer.contents[0].color}">
                        ${flexMessage.contents.footer.contents[0].action.label}
                    </button>
                </div>
            `;
            
            flexCode.textContent = JSON.stringify(flexMessage, null, 2);
            flexPreview.style.display = 'grid';
            addLog('üé® ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // Copy Flex Message JSON
        function copyFlexMessage() {
            const flexCode = document.getElementById('flexCode').textContent;
            navigator.clipboard.writeText(flexCode)
                .then(() => {
                    showNotification('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    addLog('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON Flex Message ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                })
                .catch(err => {
                    showNotification('‚ùå ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                    addLog(`‚ùå ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${err.message}`, 'error');
                });
        }

        // Display sent message preview
        function displaySentMessage(flexMessage) {
            const flexBubble = document.getElementById('flexBubble');
            const flexCode = document.getElementById('flexCode');
            const flexPreview = document.getElementById('flexPreview');
            
            flexBubble.innerHTML = `
                <div class="flex-header" style="background: ${flexMessage.contents.header.backgroundColor}; color: ${flexMessage.contents.header.contents[0].color}">
                    ${flexMessage.contents.header.contents[0].text}
                </div>
                <div class="flex-body">
                    <div style="font-weight: bold; font-size: 24px; color: ${flexMessage.contents.body.contents[0].color}">
                        ${flexMessage.contents.body.contents[0].text}
                    </div>
                    <div style="margin-top: 10px; color: #666666">${flexMessage.contents.body.contents[1].text}</div>
                    <div style="margin-top: 10px; color: #666666">${flexMessage.contents.body.contents[2].text}</div>
                    ${flexMessage.contents.body.contents[3]?.text ? `<div style="margin-top: 10px; color: #333333">${flexMessage.contents.body.contents[3].text}</div>` : ''}
                    <hr style="margin: 15px 0">
                    <div style="text-align: center; color: #999999">${flexMessage.contents.body.contents[flexMessage.contents.body.contents.length - 1].text}</div>
                </div>
                <div class="flex-footer">
                    <button class="flex-button" style="background: ${flexMessage.contents.footer.contents[0].color}">
                        ${flexMessage.contents.footer.contents[0].action.label}
                    </button>
                </div>
            `;
            
            flexCode.textContent = JSON.stringify(flexMessage, null, 2);
            flexPreview.style.display = 'grid';
        }

        // Test connection
        async function testConnection() {
            const token = document.getElementById('accessToken').value;
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }
            
            addLog('üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'info');
            try {
                await simulateApiCall(1000);
                showNotification('‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                addLog('‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                showNotification('‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                addLog(`‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
            }
        }

        // Validate credentials
        async function validateCredentials() {
            const token = document.getElementById('accessToken').value;
            if (!token) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Channel Access Token', 'error');
                return;
            }
            
            addLog('üîë ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Token...', 'info');
            try {
                await simulateApiCall(800);
                showNotification('‚úÖ Token ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'success');
                addLog('‚úÖ Token ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'success');
            } catch (error) {
                showNotification('‚ùå Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                addLog(`‚ùå Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${error.message}`, 'error');
            }
        }

        // Export data
        function exportData() {
            addLog('üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
            const dataStr = JSON.stringify(currentData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `line-api-data-${new Date().toISOString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            addLog('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // Clear data
        function clearData() {
            currentData = {};
            apiCallsToday = 0;
            document.getElementById('metricsGrid').querySelectorAll('.metric-value').forEach(el => el.textContent = '-');
            document.getElementById('metricsGrid').querySelectorAll('.status-indicator').forEach(el => 
                el.className = 'status-indicator status-loading');
            document.getElementById('metricsGrid').querySelectorAll('.metric-progress-bar').forEach(el => 
                el.style.width = '0%');
            document.getElementById('usagePercentage').textContent = '0%';
            document.getElementById('apiCallsCount').textContent = '0';
            document.getElementById('connectionStatus').textContent = '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            document.getElementById('lastUpdate').textContent = '-';
            showNotification('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            addLog('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // Test alert
        async function sendTestAlert() {
            const usagePercent = currentData.usage && currentData.quota ? 
                (currentData.usage.totalUsage / currentData.quota.value) * 100 : 80;
            const threshold = parseInt(document.getElementById('alertThreshold').value) || 80;
            await sendLineAlert(usagePercent, threshold);
        }

        // Theme toggle
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.style.background = isDarkMode ? 
                'linear-gradient(135deg, #2c3e50 0%, #4b6cb7 100%)' : 
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            document.querySelector('.theme-toggle').textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
            addLog(`üåó ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°‡πÄ‡∏õ‡πá‡∏ô ${isDarkMode ? 'Dark' : 'Light'} Mode`, 'info');
        }
    </script>
</body>
</html>
